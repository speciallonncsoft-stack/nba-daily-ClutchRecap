name: NBA Daily Update

on:
  schedule:
    # 1. ì˜¤ì „ 8:00 KST (UTC 23:00)
    - cron: '0 23 * * *'
    # 2. ì˜¤í›„ 2:00 KST (UTC 05:00)
    - cron: '0 5 * * *'
    # 3. ë°¤ 9:20 KST (UTC 12:20)
    - cron: '20 12 * * *'
  workflow_dispatch:      # ìˆ˜ë™ ì‹¤í–‰ ë²„íŠ¼

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2
        with:
          fetch-depth: 0   # ì „ì²´ ê¸°ë¡ì„ ê°€ì ¸ì™€ push ì¶©ëŒ ë°©ì§€

      - name: Setup Node
        uses: actions/setup-node@v2
        with:
          node-version: '20'

      - name: Install dependencies
        run: npm install

      - name: Run fetch script
        run: node fetch-nba.js

      - name: Commit and Push data
        run: |
          git config --global user.name "nba-bot"
          git config --global user.email "bot@example.com"
          git add .
          git diff --quiet && git diff --staged --quiet || git commit -m "Update NBA Data"
          git pull --rebase origin main
          git push origin main

      - name: Send Slack Notification
        if: success()  # ìœ„ ë‹¨ê³„ë“¤ì´ ëª¨ë‘ ì„±ê³µí–ˆì„ ë•Œë§Œ ì‹¤í–‰
        run: |
          curl -X POST -H 'Content-type: application/json' \
          --data "{\"text\":\"ğŸ€ *NBA ë°ì´í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ!* \n\nâœ… 1ì¼ 3íšŒ ìë™ ì—…ë°ì´íŠ¸ê°€ ìˆ˜í–‰ë˜ì—ˆìŠµë‹ˆë‹¤.\nğŸ“… ë‚ ì§œ: $(date +'%Y-%m-%d')\nğŸ”— ëŒ€ì‹œë³´ë“œ í™•ì¸: https://nba-daily-clutch-recap.vercel.app\"}" \
          ${{ secrets.SLACK_WEBHOOK_URL }}
